expr {=
	def rsGet {=
		def.kv rs, field, row;
		def.body {=
			var i: 0, fieldIndex: 0;
			for format in rs.f {=
				if format.n == field {=
					set fieldIndex: i;
				};
				set i: i + 1;
			};
			at {= at rs.d row } fieldIndex;
		}
	};

	def recGet {=
		def.pos record, fieldName;
		def.body {= at record.d {=at record._mapping fieldName } }
	};

	def recGetStr {=
		def.pos record, fieldName;
		def.body {=
			var
				fmt: {= at record.f {=at record._mapping fieldName} },
				value: {= recGet record fieldName },
				result: undef;
			if {= has fmt "enum" } {=
				for enumPair in fmt.enum {=
					if {=int enumPair.v} == {=int value} {=
						if {=has enumPair "n"} {=
							set result: enumPair.n;
						} else {=
							set result: enumPair.v;
						}
					}
				}
			} else {=
				set result: value;
			};
			__render__ __result__: result;
		}
	};

	expr undef;
}