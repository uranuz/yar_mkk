
I. НАСТРОЙКА ДОСТУПА К СЕРВЕРУ:
	1. Заходим на сервак по SSH под root с тем паролем, который указан в админской панели VPS провайдера:
		ssh root@new.yar-mkk.ru
		Адрес тестового сайта может быть другим (либо можно зайти по IP-адресу)
	2. Сначала обновимся на всякий случай:
		sudo apt update
		sudo apt upgrade
	3. Настройка локали (опционально, также есть в скрипте):
		sudo locale-gen ru_RU.UTF-8
		sudo locale-gen en_US.UTF-8
		sudo update-locale LANG=ru_RU.UTF-8
	4. Нужно первым делом правильно настроить доступ на сервер.
		Создадим нового пользователя под которым будем ходить:
		sudo adduser yar_mkk
		Добавим его в группу админов (sudo)
		sudo adduser yar_mkk sudo
		Перезайдем под этим пользователем... (ВАЖНО!)
		exit
		ssh yar_mkk@new.yar-mkk.ru
	5. Полезные программы поставим (опционально, только ради удобства):
		sudo apt install htop nano mc curl
	6. Открываем через nano (или через другой редактор)
		sudo nano /etc/ssh/sshd_config
		
		Пропишем на данном этапе параметры:
		Port <порт SSH>
		PermitRootLogin no
		...т.е. мы закрыли доступ под рутом, и будем ходить через пользователя yar_mkk по необычному порту
		
		Перезапустим сервер SSH
		sudo systemctl restart sshd
	7. Создаём файлы ключей (команда запускается из под того пользователя, для которого настраивается вход)
		ssh-keygen -t rsa -b 4096 -C "yar_mkk.ru@yar-mkk.ru (92.63.96.97) from 22.09.2019"
		После опции -С идет комментарий. Лучше задать, чтобы потом понимать, что ето за ключ
		Нужно задать пароль для закрытого ключа для пущей безопасности (и запомнить)

		Забираем (через копирование текста) себе закрытый ключ (и открытый ключ тоже):
			cat ~/.ssh/id_rsa
			cat ~/.ssh/id_rsa.pub
		...можно и по-другому скачать, например, через sftp...
		Сохраняем их себе для доступа (названия файлов лучше не менять)
		
		Удаляем закрытый ключ с сервера, т.к. он не нужен там
		rm ~/.ssh/id_rsa

	8. Необходимо перекинуть ключ  в специалный файл
		cd ~/.ssh
		touch authorized_keys
		
		Зададим владельца на файл:
		chown yar_mkk:yar_mkk authorized_keys
		
		Собственно скопируем данные:
		cat ~/.ssh/id_rsa.pub >> authorized_keys

		Установка прав на файл и папку:
		chmod 0700 ~/.ssh/
		chmod 0600 ~/.ssh/authorized_keys
		
		Проверим, что текст скопировался:
		cat ~/.ssh/authorized_keys

		Удаляем открытый ключ из начального расположения:
		rm ~/.ssh/id_rsa.pub

	11. Настраиваем заход через ключ (нужно подредактировать конфиг-файл демона SSH):
		sudo nano /etc/ssh/sshd_config

		Нужно задать значение параметров:
			# разрешаем авторизацию при помощи ключей
			PubkeyAuthentication yes
			
			# Путь, где будут находиться ключи, с которых можно подключать.
			# Для каждого пользователя свой файл в его директории.
			AuthorizedKeysFile %h/.ssh/authorized_keys
			
			Тут стоит проверить другие параметры безопасности...
			
			# Время ожидания авторизации
				LoginGraceTime 30
			Таймаут при отсутствии активности соединения.

			Автоматическое отключение соединения после определенного времени, в течение которого зафиксировано бездействие в консоли.

			ClientAliveCountMax – Параметр указывает на полное количество сообщений, отсылаемых ssh-сервером для распознавания активности ssh-клиента. По умолчанию это 3.
			ClientAliveInterval – Параметр указывает на время ожидания в секундах. По истечению ssh-сервер отошлет сообщение-запрос клиенту. По умолчанию значение этого параметра – 0. Сервер не отсылает сообщение для проверки.

			Отключение ssh-клиента автоматически после 5 минут (300 секунд):
				ClientAliveInterval 300
				ClientAliveCountMax 0
			
			У нас нет графического интерфейса на сервере, т.е. можно отключить
				X11Forwarding no
			
	12. Применяем настройки демона SSH:
		sudo systemctl restart sshd

	13. Пробуем зайти по ключу со своей локальной машины:
		ssh yar_mkk@new.yar-mkk.ru -p <порт SSH> -i "<путь к файлу закрытого ключа>"
		
		Замечание: у ключа на локальной машине тоже нужно "сузить" разрешения (иначе будет ругаться)
			chmod 700 <Путь к папке ключа>/id_rsa
			chmod 700 <Путь к папке ключа>/id_rsa.pub

	14. Если вход успешно удался, то далее отключаем вход по паролю:
		sudo nano /etc/ssh/sshd_config
		
		Задаём параметр:
			PasswordAuthentication no
		
		Думаю можно задать ещё:
			UsePAM no

		Снова перезапускаем демон SSH для применения:
			sudo systemctl restart sshd

	15. Проверить еще раз, что можно зайти через файл закрытого ключа, но нельзя зайти по паролю (!!!)
